<link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js" type="text/javascript"></script>

<div class="container">
 <div class="inline-block_location">
  <div id="map" style="width:250px; height:250px;"></div>
 </div>
 <div class="inline-block_location">
  <div class="table-responsive">
   <table class="table table table-striped">
    <h2 id="address"><%=@location.name%><h2>
     <tbody>
     <tr>
      <th>郵便番号</th>
      <td class="left"><%= @location.postcode %></td>
     </tr>
     <tr>
      <th>都道府県</th>
      <td class="left"><%= @location.prefecture %></td>
     </tr>
     <tr>
      <th>住所</th>
      <td class="left"><%= @location.address%></td>
     </tr>
    </tbody>
   </table>
  </div>
 </div>
 <h3><span id="view_time"></span>の天気</h3>
 <div class="table-responsive">
  <table class="table table-bordered">
   <tbody>
    <tr>
     <th>時間(時)</th>
     <th class="center"><span id="next3"></span></th>
     <th class="center"><span id="next6"></span></th>
     <th class="center"><span id="next9"></span></th>
     <th class="center"><span id="next12"></span></th>
     <th class="center"><span id="next15"></span></th>
     <th class="center"><span id="next18"></span></th>
     <th class="center"><span id="next21"></span></th>
     <th class="center"><span id="next24"></span></th>
    </tr>
    <tr>
     <th class="vc">天気<th>
     <div class="center"><span id="tenkilogo0" class="bold"></span></div>
     <td><div class="center"><span id="tenkilogo1" class="bold"></span></div></td>
     <td><div class="center"><span id="tenkilogo2" class="bold"></span></div></td>
     <td><div class="center"><span id="tenkilogo3" class="bold"></span></div></td>
     <td><div class="center"><span id="tenkilogo4" class="bold"></span></div></td>
     <td><div class="center"><span id="tenkilogo5" class="bold"></span></div></td>
     <td><div class="center"><span id="tenkilogo6" class="bold"></span></div></td>
     <td><div class="center"><span id="tenkilogo7" class="bold"></span></div></td>
    </tr>
    <tr>
     <th>気温(℃)</th>
     <td><span id="temp0" class="bold"></span></td>
     <td><span id="temp1" class="bold"></span></td>
     <td><span id="temp2" class="bold"></span></td>
     <td><span id="temp3" class="bold"></span></td>
     <td><span id="temp4" class="bold"></span></td>
     <td><span id="temp5" class="bold"></span></td>
     <td><span id="temp6" class="bold"></span></td>
     <td><span id="temp7" class="bold"></span></td>
    </tr>
    <tr>
     <th>風向</th>
     <td><span id="winddeg0" class="bold"></span></td>
     <td><span id="winddeg1" class="bold"></span></td>
     <td><span id="winddeg2" class="bold"></span></td>
     <td><span id="winddeg3" class="bold"></span></td>
     <td><span id="winddeg4" class="bold"></span></td>
     <td><span id="winddeg5" class="bold"></span></td>
     <td><span id="winddeg6" class="bold"></span></td>
     <td><span id="winddeg7" class="bold"></span></td>
     
    </tr>
    <tr>
     <th>風速(m/s)</th>
     <td><span id="wind0" class="bold"></span></td>
     <td><span id="wind1" class="bold"></span></td>
     <td><span id="wind2" class="bold"></span></td>
     <td><span id="wind3" class="bold"></span></td>
     <td><span id="wind4" class="bold"></span></td>
     <td><span id="wind5" class="bold"></span></td>
     <td><span id="wind6" class="bold"></span></td>
     <td><span id="wind7" class="bold"></span></td>
    </tr>
   </tbody>
  </table>
 </div>

 <div>
    <a class="btn btn-default navbar-btn main_link_btn fa fa-camera" href=/locations/@location[:id]/post>投稿</a>
    <h3>投稿画像一覧</h3>

    <% @location.posts.each do |post| %>
        <%=link_to post.post_img.url,"data-lightbox"=>post.post_img.url do %>
            <%=image_tag post.post_img.url,style:"width:300px;" if post.post_img?%>
        <%end%>
    <% end %>
 </div>
</div>

<!--日付-->
<script>
var now = new Date();
const numbers=[3,6,9,12,15,18,21,24];
numbers.forEach((i)=>
{var next = new Date(now.getHours() + i*60*60*1000);
document.getElementById("next"+i).innerHTML =  next.getHours();
});

var mon=now.getMonth()+1;
var day=now.getDate();
document.getElementById("view_time").innerHTML= mon+"/"+day

var get_hour = function(hour){
	if (0 <=hour <3) t = 3;
	if (3 <=hour <6) t = 6;
	if (6 <=hour <9) t = 9;
	if (9 <=hour <12) t = 12;
	if (12 <=hour <15) t = 15;
	if (15 <=hour <18) t = 18;
	if (18 <=hour <21) t = 21;
	if (21 <=hour <24) t = 0;
	return t;
}
 </script>

<!--お天気API-->
<script>
$(function (){

   var lat = <%= @location.geolat %>
   var lng = <%= @location.geolng %>

    //$.post("http://api.openweathermap.org/data/2.5/weather?lat="+lat+"&lon="+lng+"&APPID=<%= ENV['OWM_API_KEY'] %>&lang=ja&units=metric",
    $.post("http://api.openweathermap.org/data/2.5/forecast?lat="+lat+"&lon="+lng+"&APPID=<%= ENV['OWM_API_KEY'] %>&lang=ja&units=metric&cnt=8",

   function(json){
	   for (let n=0; n<=7; n++) {
        $("#tenki").html(json.list[n].weather[0].description);
        $("#temp"+n).html(Math.round(json.list[n].main.temp));
        $("#winddeg"+n).html(get_deg(json.list[n].wind.deg));
        $("#wind"+n).html(Math.round(json.list[n].wind.speed));
        //$("#time1").html(json.list[3].dt_txt);
       
      //天気ロゴ
      switch (json.list[n].weather[0].main){
         case 'Clear':
         $("#tenkilogo"+n).html("<img src='http://openweathermap.org/img/w/01d.png' >");
         break;
         case 'Clouds':
         $("#tenkilogo"+n).html("<img src='http://openweathermap.org/img/w/04d.png' >");
         break;
         case 'Rain':
         $("#tenkilogo"+n).html("<img src='http://openweathermap.org/img/w/09d.png' >");
         break;
         case 'Snow':
         $("#tenkilogo"+n).html("<img src='http://openweathermap.org/img/w/13d.png' >");
         break;
         case 'Fog':
         $("#tenkilogo"+n).html("<img src='http://openweathermap.org/img/w/50d.png' >");
         break;
         case 'Mist':
         $("#tenkilogo"+n).html("<img src='http://openweathermap.org/img/w/50n.png' >");
         break;
         case 'Haze':
         $("#tenkilogo"+n).html("<img src='http://openweathermap.org/img/w/50d.png' >");
         break;
         default:
         $("#tenkilogo"+n).html("<img src='http://openweathermap.org/img/w/01n.png' >");
      };
     }  
    });
});


//風向
 var get_deg = function(deg) {
  var r = '北';
  if (deg>=11.25) r = '北北東';
  if (deg>=33.75) r = '北東';
  if (deg>=56.25) r = '東北東';
  if (deg>=78.75) r = '東';
  if (deg>=101.25) r = '東南東';
  if (deg>=123.75) r = '南東';
  if (deg>=146.25) r = '南南東';
  if (deg>=168.75) r = '南';
  if (deg>=191.25) r = '南南西';
  if (deg>=213.75) r = '南西';
  if (deg>=236.25) r = '西南西';
  if (deg>=258.75) r = '西';
  if (deg>=281.25) r = '西北西';
  if (deg>=303.75) r = '北西';
  if (deg>=326.25) r = '北北西';
  return r;
 }
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script> 

<!--地図API-->
<script>
var lat = <%= @location.geolat %>
var lng = <%= @location.geolng %>

function initMap(){
   geocoder = new google.maps.Geocoder()
   var options = {
      zoom:8,
      center:{lat: lat,lng: lng}
   }
   
   var map = new
   google.maps.Map(document.getElementById("map"),options);
   
   var marker = new google.maps.Marker({
      position:{lat: lat,lng: lng},
      map: map
   });
}

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
